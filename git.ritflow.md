# Соглашение о процессе разработки в репозиториях git
## Описание

Данный документ описывает соглашение о процессе разработки кода продукта с использованием git репозитория.

Описываемый процесс призван уменьшить количество конфликтов при слияниях веток, определить обязанности и границы ответсвенности в команде разработки, создать единообразие в ведении репозиториев и уменьшить объём коммуникаций в команде разработки.

Описываемый процесс является достаточным для автоматизации процедуры деплоя на test и production среды.

Данный процесс является производным от процесса [GitFlow](https://habr.com/post/106912/).

## Этапы разработки (fix, feature)

### 1. Формирование перечня задач

На данном этапе формируется перечень задач, которые войду в релиз определенной версии. Задачи должны быть поставлены в task tracker и иметь уникальные номера.

Результатом данного этапа должна стать стабилизационная ветвь - релиза новой версии продукта отрощенная от ветки master. Работы проводятся ролью [Lead](#lead).

### 2. Разработка решения задачи

На данном этапе производится решение поставленной задачи в отдельной ветке решения задачи. Работы проводятся ролью [Developer](#developer).

После завершения работы над кодом обязательно проводится стабилизация ветки решения и после решения конфликтов создаётся запрос на слияние в системе управления репозиторием. Задача на слияние веток ставится на [Reviewer](#reviewer)

### 3. Review решения задачи

На данном этапе проводится проверка кода решения для выявления недочётов. С данного этапа возможно возвращение решения задачи на доработку. Работы проводятся ролью [Reviewer](#reviewer).

### 4. Слияние решений задачи

На данном этапе производится слияние ветви решения с ветвью релиза. Работы проводятся ролью [Reviewer](#reviewer).

### 5. Deploy тестового стенда

На данном этапе проводится деплой текущей ветки релиза на test стенд. В случае если разворот не успешен задача возвращается [Developer](#developer) на доработку. Работы проводятся ролью [Reviewer](#reviewer).

### 6. Заморозка

Данный этап начинается после того, как все задачи запланированные на релиз решены. На данном этапе запрещено добавлять в релиз новые [feature](#TASK_TYPE). Заморозку объявляет роль [Lead](#lead)

### 7. Тестирование

Этап проверки, что функционал продукта работает стабильно, все заявленные [feature](#TASK_TYPE) реализованы в соответсвии с постановкой задач, все [bugfix](#TASK_TYPE) исправлены и не пострадал основной функционал продукта.

### 8. Исправлени недочётов

При выявлении недочётов на этапе [тестирования](#Тестирование) проводится регистрация недочётов в системе task tracker и инициируется исправление проблем. Тестирование проводит роль [Tester](#Tester) на test стенде.

### 9. Релиз

На данном этапе проводится сляние ветки текущего релиза и ветки master. За тем производит деплой на production стенд. Работы проводятся ролью [Lead](#lead)

## Этапы экстренной поддержки решения (hotfix)

### 1. Разработка решения задачи

На данном этапе производится решение поставленной задачи в отдельной ветке решения задачи. Работы проводятся ролью [Developer](#developer).

### 2. Review решения задачи

На данном этапе проводится проверка кода решения для выявления недочётов. С данного этапа возможно возвращение решения задачи на доработку. Работы проводятся ролью [Lead](#lead).

### 3. Выпуск hotfix

На данном этапе проводится сляние ветви hotfix с ветвью master и последующий деплой на production стенд. Работы проводятся ролью [Lead](#lead).

### 4. Стабилизация текущей ветки релиза

На данном этапе проводится стабилизация текущей ветви релиза от ветви hotfix. Работы проводятся ролью [Lead](#lead).

### 5. Обновление тестового стенда

На данном этапе проводится деплой текущей ветки релиза на test стенд. Работы проводятся ролью [Lead](#lead).

## Роли в процессе разработки

В процессе работы с git выделяются роли с определённым набором ответсвенности относительно кодовой базы.

### Developer

Инженер разрабатывающий решение для задачи. Несёт ответственность за конечную реализацию решения задачи и полное соответсвие решения постановке задачи.

### Reviewer 

Инженер проводящий review кода. Несёт ответсвенность за качество проверяемого кода.

### Lead

Инженер принимающий решение о релизе продукта, несёт ответсвенность за кодовую базу продукта.

### Tester

Инженер проводящий тестирование решения, несёт отвественность за полное соответсвие решения постановке задачи(ДВОЙНАЯ ОТВЕТСВЕННОСТЬ).

## Общий пример ветвления

![RIT GitFlow](/img/process.png)

## Ветвь master

Основная ветвь продукта. Ветвь master содержит текущее состояние кода продукта и список изменений вносимых в продукт.

## Ветви релизов

Ветви предназначенные для стабилизации разрабатываемых решений задач и формирования перечня решений входящий в определенный релиз.

Ветвь релиза существует до тех пор пока не будет слита с ветвью master. После слияния в ветвь релиза запрещено вливать другие ветви. 

### Соглашение о именовании ветвей релизов

Формат названия ветки: release_[VERSION]

Пример названия ветки: release_1.2.3

## Ветви решений

Ветви предназначенные для хранения решений задач. Для каждой задачи создаётся отдельная ветвь.

Ветвь решения существует до тех пор пока не будет слита с ветвью текущего релиза. После слияния с ветвью релиза запрещено вносить изменения в ветвь решения. Все проблемы после слияния с ветвью текущего релиза должны фиксироваться в системе task tracker и быть исправлены в отдельных ветках.

### Соглашение о именовании ветвей решений

Формат названия ветки: [[TASK_TYPE]](#task_type)-[[TASK_TRACKER]](#task_tracker)-[[TASK_NUMBER]](#task_number)-[[TASK_SHORT_NAME]](#task_short_name)

Пример названия ветки: feature-YT-TA-71-add_building_selection_to_main_search

### Описание подстановочных параметров

#### TASK_TYPE

Тип задачи в системе task tracker. Может быть 3х типов:
* feature - новая функция или фича продукта
* bugfix - исправление некорректного поведения продукта
* hotfix - срочное исправление некорректного поведения продукта

#### TASK_TRACKER

Наименование системы task tracker, например Jira или YT 

#### TASK_NUMBER

Полный номер задачи из системы bug tracker, например TA-71 или DW-34

#### TASK_SHORT_NAME

Краткое название задачи отражающее суть задачи, например add_date_filter_to_main_search

## Стабилизация

Процесс слияния уже разработанных и прошедших review ветвей решений задач, ветви master или ветвей релизов с целевой ветвью.

Стабилизация проводится из обновленной(!) стабилизационной ветви в целевой ветке при помощи команды:

    git pull --all
    git merge --no-ff release_1.2.3

## Инструкции

### Инструкция работы [Developer](#developer) с ветвями feature и bugfix

#### 1. Создание ветки решения

    git pull --all
    git checkout -b feature-YT-TA-71-add_building_selection_to_main_search master

#### 2. Стабилизация от текущей ветки релиза
    
    git pull --all
    git merge --no-ff release_1.2.3

#### 3. Разработка решения

В процессе разработке используется исключительно добавление результатов в виде коммитов и отправка на головной сервер в ветку решения задачи

    git add .
    git commit -m "Commit text"
    git push -u origin feature-YT-TA-71-add_building_selection_to_main_search

При необходимости проводится стабилизация от ветки релиза

    git pull --all
    git merge --no-ff release_1.2.3

#### 4. Стабилизация от текущей ветки релиза

    git pull --all
    git merge --no-ff release_1.2.3
    git push -u origin feature-YT-TA-71-add_building_selection_to_main_search

#### 5. Отправка запроса на слияние с текущей ветвью релиза

Запрос на слияние ветви решения с текущей ветвью релиза отправляется в системе управления репозиторием инженеру с ролью [Reviewer](#reviewer).

### Инструкция работы [Developer](#developer) с ветвями hotfix

#### 1. Создание ветки решения

    git pull --all
    git checkout -b hotfix-YT-TA-80-incorrect_search_results master

#### 2. Разработка решения

В процессе разработке используется исключительно добавление результатов в виде коммитов и отправка на головной сервер в ветку решения задачи

    git add .
    git commit -m "Commit text"
    git push -u origin hotfix-YT-TA-80-incorrect_search_results

При необходимости проводится стабилизация от ветви master

    git pull --all
    git merge --no-ff master


#### 3. Отправка запроса на слияние с ветвью master

Запрос на слияние ветви решения с ветвью master отправляется в системе управления репозиторием инженеру с ролью [Lead](#lead).

### Инструкция работы [Reviewer](#reviewer)

#### 1. Проверка кода

На данном этапе проводится проверка кода на соответствие общепринятым стандартам стилистики и проверка алгоритмов решения. 

#### 2. Замечания

В случае выявления замечаний, замечания вносятся в виде комментариев к merge request в системе управления git и merge request отклоняется.

#### 3. Подтверждение merge request

В случае если код не имеет замечаний merge request подтверждается. подтверждение производится в системе git репозитория.

#### 4. Deploy на тест сервер

Инженер с ролью [Reviewer](#reviewer) производит сборку проекта и Deploy новой версии на тестовый стенд для дальнейшего тестирования.

### Инструкция работы [Tester](#Tester) с ветвями feature и bug

По подготовленным тестовым сценариям для функционала производит тестирование. В случае если найдены ошибки передаёт их разработчику для исправления.

### Инструкция работы [Tester](#Tester) с ветвями release

при заморозке рилиза производит регрессионное тестирование функционала по всем тестовым сценариям. В случае выявления ошибок регестрирует их как задачи типа bug и вносит в текущий релиз.

### Инструкция работы [Lead](#lead) с ветвями release

#### 1. Отправка запроса на слияние с ветвью master

Изнженер с ролью [Lead](#lead) отправляет запрос на слияние (merge request) ветви release с ветвью master в системе управления репозиторием инженеру с ролью [Lead](#lead).

#### 2. Проверка кода

Инженер производит проверку на предмет корректности слияния и отсутствия конфликтов между ветвями. В случае если ветви имеют конфликты инженер устраняет их в ветви release.

#### 3. Подтверждение merge request

Инженер подтверждает merge request

#### 4. Deploy на production сервер

Инженер производит Deploy ветки master на production сервер проекта

#### 5. Smoke test

Инженер производит тестирование базовых функциональностей продукта и в случае отказа производит откат до прошлой версии ветви master

### Инструкция работы [Lead](#lead) с ветвями hotfix 

#### 1. Проверка кода

На данном этапе проводится проверка кода на соответствие общепринятым стандартам стилистики и проверка алгоритмов решения.

#### 2. Замечания

В случае выявления замечаний, замечания вносятся в виде комментариев к merge request в системе управления git и merge request отклоняется.

#### 3. Deploy на тестовый стенд

Инженер производит Deploy ветки hotfix на тестовом стенде.

#### 4. Воспроизведение сценария ошибки на тестовом стенде

Инженер воспроизводит сценарий отказа системы и проверяет исправлена ли проблема. В случае если проблема исправлена подтверждает merge request. В случае если проблема не исправлена отклоняет merge request.

#### 5. Deploy на production стенд

Инженер производит Deploy на production стенд ветки master. 

### 6. Стабилизация текущей ветки релиза

Изнженер с ролью [Lead](#lead) отправляет запрос на слияние (merge request) ветви hotfix с ветвью release в системе управления репозиторием инженеру с ролью [Lead](#lead).

#### 7. Проверка кода

Инженер производит проверку на предмет корректности слияния и отсутствия конфликтов между ветвями. В случае если ветви имеют конфликты инженер устраняет их в ветви release.

#### 8. Подтверждение merge request

Инженер подтверждает merge request

### 9. Deploy на тест сервер

Инженер производит сборку проекта и Deploy новой версии на тестовый стенд.
